<!DOCTYPE html>
<!--[if IE 8 ]>    <html class="ie ie8 ie-lt10 ie-lt9 no-js" lang="en"> <![endif]-->
<!--[if IE 9 ]>    <html class="ie ie9 ie-lt10 no-js" lang="en"> <![endif]-->
<!--[if gt IE 9]><!--><html class="no-js" lang="en"><!--<![endif]-->
    
<!-- Mirrored from zonasegura.mibanco.com.pe/frontend/login/b.resolvedLink by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 10 May 2024 17:19:23 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
        





<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>Mibanco</title>

<!--  Mobile Viewport Fix
http://j.mp/mobileviewport & http://davidbcalhoun.com/2010/viewport-metatag
device-width : Occupy full width of the screen in its current orientation
initial-scale = 1.0 retains dimensions instead of zooming out if page height > device height
maximum-scale = 1.0 retains dimensions instead of zooming in if page width < device width
-->
<!-- Uncomment to use; use thoughtfully!
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
-->

<meta name="description" content="">
<meta name="AUTHOR" content="Manentia Software - www.manentiasoftware.com" />
<meta name="POWEREDBY" content="Nazca Internet Banking - www.manentiasoftware.com/nazca" />
<meta name="VERSION" content="4.2.35"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, target-densityDpi=device-dpi">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta http-equiv="Cache-Control" content="no-cache, no-store, private, must-revalidate, max-age=0"/>
<meta http-equiv="Expires" CONTENT="0"/>
<meta http-equiv="Pragma" content="no-cache"/>

<!-- -----------------------------------------------------------------------
CSS
------------------------------------------------------------------------ -->

<link rel="stylesheet" type="text/css" href="../themes/mibanco/css/plugins/jquery.mCustomScrollbar.css">
<link rel="stylesheet" href="../themes/mibanco/css/reset.css"/>
<link rel="stylesheet" href="../themes/mibanco/css/tooltipster.bundle.min.css">
<link rel="stylesheet" type="text/css" href="../themes/mibanco/css/plugins/colorbox.css">
<link rel="stylesheet" href="../themes/mibanco/css/main7cdd.css?version=4.2.35"/>
<link rel="stylesheet" href="../themes/mibanco/css/print.css" media="print"/>

<!-- -----------------------------------------------------------------------
Favicon
------------------------------------------------------------------------ -->
<link rel="apple-touch-icon" sizes="57x57" href="../themes/mibanco/img/favicons/apple-icon-57x57.png"/>
<link rel="apple-touch-icon" sizes="60x60" href="../themes/mibanco/img/favicons/apple-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="../themes/mibanco/img/favicons/apple-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="../themes/mibanco/img/favicons/apple-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="../themes/mibanco/img/favicons/apple-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="../themes/mibanco/img/favicons/apple-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="../themes/mibanco/img/favicons/apple-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="../themes/mibanco/img/favicons/apple-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="../themes/mibanco/img/favicons/apple-icon-180x180.png">
<link rel="icon" type="image/png" sizes="192x192" href="../themes/mibanco/img/favicons/android-icon-192x192.png">
<link rel="icon" type="image/png" sizes="32x32" href="../themes/mibanco/img/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="96x96" href="../themes/mibanco/img/favicons/favicon-96x96.png">
<link rel="icon" type="image/png" sizes="16x16" href="../themes/mibanco/img/favicons/favicon-16x16.png">
<link rel="manifest" href="https://zonasegura.mibanco.com.pe/frontend/themes/mibanco/img/favicons/manifest.json">
<meta name="msapplication-TileColor" content="#ffffff">
<meta name="msapplication-TileImage" content="../themes/mibanco/img/favicons/ms-icon-144x144.png">
<meta name="theme-color" content="#ffffff">

<!-- -----------------------------------------------------------------------
Javascript
------------------------------------------------------------------------ -->
<script src="../js/jquery-3.6.0.min.js"></script>
<script src="../js/jquery-ui-1.10.4.custom.min.js"></script>
<script src="../js/jquery.restrict.js"></script>
<script src="../js/tooltipster.bundle.min.js"></script> 
<script src="../js/jquery.alphanum.js"></script>
<script src="../js/modernizr.js"></script>
<script src="../js/jquery.colorbox-min.js"></script> 

<script src="../js/jquery.mousewheel.min.js"></script>
<script src="../js/jquery.mCustomScrollbar.min.js"></script> 

<script src="../js/smartbanner.min.js"></script>
<script src="../js/tdynamic.js"></script>
<script src="../js/validations.js"></script>

<script src="../js/jsencrypt.min.js"></script>
<script>

    function encryptTxt(rawTxt) {

        var isEncryptionEnabled = false;
        if (isEncryptionEnabled === null || !isEncryptionEnabled) {
            return rawTxt;
        }

        var encryptor = new JSEncrypt();
        encryptor.setPublicKey("2222");
        
        var encryptedTxt = encryptor.encrypt(rawTxt);
        return (encryptedTxt ? encryptedTxt : rawTxt);
    }

</script>

<!-- -----------------------------------------------------------------------
Smart banner app download
------------------------------------------------------------------------ -->

<!--ios meta tag-->
<meta name="apple-itunes-app" content="app-id=1437814246, affiliate-data=banner, app-argument=homebanking">

<!-- Start SmartBanner configuration -->
<meta name="smartbanner:title" content="Mibanco">
<meta name="smartbanner:author" content="Abrir en la app de Mibanco Móvil">
<meta name="smartbanner:price" content="GRATIS">
<meta name="smartbanner:price-suffix-apple" content=" - Obtener en el App Store">
<meta name="smartbanner:price-suffix-google" content="- Obtener en Google Play">
<meta name="smartbanner:icon-apple" content="/frontend/themes/mibanco/img/mibanco-icon-app@2x.png">
<meta name="smartbanner:icon-google" content="/frontend/themes/mibanco/img/mibanco-icon-app@2x.png">
<meta name="smartbanner:button" content="Ver">
<meta name="smartbanner:button-url-apple" content="https://apps.apple.com/pe/app/mibanco/id1437814246">
<meta name="smartbanner:button-url-google" content="https://play.google.com/store/apps/details?id=com.mibanco.bancamovil&hl=es_PE">
<meta name="smartbanner:custom-design-modifier" content="mibanco">
<meta name="smartbanner:enabled-platforms" content="android">
<meta name="smartbanner:close-label" content="Close">
<meta name="smartbanner:hide-ttl" content="10000">
<!--<meta name="smartbanner:exclude-user-agent-regex" content="Safari">-->
<!-- End SmartBanner configuration -->

<script type="text/javascript">
    
    var PROCESSING = false;
    var keyList = {};
</script>

<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'../../../www.googletagmanager.com/gtm5445.html?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-KKVL4N8');
</script>
<!-- End Google Tag Manager -->
<script>
<!-- Facebook Pixel Code -->
  !function(f,b,e,v,n,t,s)
  {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
  n.callMethod.apply(n,arguments):n.queue.push(arguments)};
  if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
  n.queue=[];t=b.createElement(e);t.async=!0;
  t.src=v;s=b.getElementsByTagName(e)[0];
  s.parentNode.insertBefore(t,s)}(window, document,'script',
  '../../../connect.facebook.net/en_US/fbevents.js');
  fbq('init', '102441836939646');
  fbq('track', 'PageView');
</script>
<noscript>
  <img height="1" width="1" style="display:none" 
       src="https://www.facebook.com/tr?id=102441836939646&amp;ev=PageView&amp;noscript=1"/>
</noscript>
<!-- End Facebook Pixel Code -->

<!-- head-mobile-->
<script>

    (function ($) {

        // Configuracion por defecto
        var defaults = {
            // Options
            data: {},
            timeout: 30000,
            useLoadingAnimation: true,
            stopProcessingAfter: true,
            hideErrors: true,
            /**
             * Función a ejecutar si el pedido se realizo correctamente y la respuesta es JSON
             * con categoria Info (ej: COR000I) o la respuesta es HTML.
             * No hay una implementación por defecto, se muestra un alert si no se implementa
             * 
             * @param {JSON} response Respuesta del servidor
             * @returns {undefined}
             */
            onSuccess: function (response) {
                alert("[ajax.js] El callback 'onSuccess' debe ser implementado");
            },
            /**
             * Función a ejecutar si el pedido se realizó correctamente y la respuesta es JSON
             * con categoria Warning (ej: COR020W). La implementación por defecto marca los
             * campos recibidos en response.data utilizando "showFormErrors(response)"
             * 
             * @param {JSON} response Respuesta del servidor
             * @returns {undefined}
             */
            onWarning: function (response) {
                showFormErrors(response);
                cleanCredentialFields();
            },
            /**
             * Función a ejecutar si el pedido se realizó correctamente y la respuesta es JSON
             * con categoria Error (ej: COR015E). La implementación por defecto redirige a la
             * página de error global con el codigo de retorno (response.code)
             * 
             * @param {JSON} response Respuesta del servidor
             * @returns {undefined}
             */
            onError: function (response) {
                goToPage("/frontend/error?status=" + response.code);
            },
            /**
             * Función a ejecutar si el pedido demora mas de "timeout" milisegundos. Por
             * defecto se ejecuta la función "showTimeoutNotification()"
             *
             * @returns {undefined}
             */
            onTimeout: function () {
                showTimeoutNotification();
            },
            /**
             * Función a ejecutar si el pedido se completo correctamente (se obtuvo un HTTP
             * status code 200). Por defecto si se trata de un request JON se evalúa 
             * response.code y según la categoría se ejecuta "onSuccess(response)", 
             * "onWarning(response)" o "onError(response)", en caso de no ser JSON, se
             * ejecuta "onSuccess(response)".
             * 
             * @param {jqXHR} xhr Objeto XMLHttpRequest de jQuery
             * @param {type} status Estado del request ("success", "notmodified", "nocontent",
             *                      "error", "timeout", "abort", or "parsererror")
             * @param {JSON || String} data Respuesta del servidor
             * @returns {undefined}
             */
            onRequestDone: function (xhr, status, data) {
                var ct = xhr.getResponseHeader("content-type");
                if ((ct !== null) && (ct.startsWith("application/json"))) {
                    if (data && data.code && data.code.endsWith("I")) {
                        this.onSuccess(data);
                    } else if (data && data.code && data.code.endsWith("W")) {
                        if (data.code === 'COR091W') {
                            var redirectUrl = "https://zonasegura.mibanco.com.pe/frontend/logout";
                            goToPage(redirectUrl + "#!session.maxAttemptsReached:error");
                        } else {
                            this.onWarning(data);
                        }
                    } else {
                        this.onError(data);
                    }
                } else {
                    this.onSuccess(data);
                }
            },
            /**
             * Función a ejecutar si se produjeron errores en el pedido (se obtuvo un HTTP
             * status code distinto de 200). Por defecto si el status code es 401 se
             * redirecciona al login, en otro caso se redirecciona a la pagina de error
             * correspondiente a ese código (si existe, si no a la del status code 500)
             * 
             * @param {jqXHR} xhr Objeto XMLHttpRequest de jQuery
             * @param {type} status Estado del request ("success", "notmodified", "nocontent",
             *                      "error", "timeout", "abort", or "parsererror")
             * @param {JSON || String} error Respuesta del servidor
             * @returns {undefined}
             */
            onRequestFail: function (xhr, status, error) {
                if (xhr.status === 401) {
                    try {
                        var response = JSON.parse(xhr.responseText);
                        var code = response.code;

                        var redirectUrl = "https://zonasegura.mibanco.com.pe/frontend/login";
                        if (response.data.environment) {
                            redirectUrl += "?env=" + response.data.environment;
                        }
                        redirectUrl += response.data.environment ? "&" : "?";
                        redirectUrl += "url=" + location.href;

                        var messageKey = response.message;
                        goToPage(redirectUrl + "#!" + messageKey + ":error");
                    } catch (err) {
                        goToPage("/frontend/error?code=CLI999E");
                    }
                } else if (xhr.status === 404) {
                    goToPage("/frontend/error?status=404");
                } else {
                    
                    if (xhr.status !== 0) {
                        // Las excepciones retornan error 500
                        try {
                            var response = JSON.parse(xhr.responseText);
                            var code = response.code;
                        } catch (err) {
                            code = "COR999E";
                        }
                    
                        goToPage("/frontend/error?code=" + code);
                    }
                }
            }
        };

        //
        // POST
        //
        $.fn.postWithTimeout = function (options) {
            var _this = $(this);

            startProcessing(_this);
            
            var settings = $.extend({}, defaults, options);
            
            if (settings.hideErrors) {
                hideFormErrors();
            }
            
            if (settings.useLoadingAnimation) {
                _this.addClass("state-loading");
            }
            _this.prop("disabled", true);
            $.ajax({
                type: "POST",
                url: getURL(settings.url),
                headers: {"X-Requested-With": "XMLHttpRequest"},
                data: settings.data,
                timeout: settings.timeout,
                context: settings

            }).done(function (data, status, xhr) {
                if (typeof settings.onRequestDone === "function") {
                    settings.onRequestDone(xhr, status, data);
                    resetProcessingState(data, settings, _this);
                } else {
                    alert("[ajax.js] El callback 'onRequestDone' no es válido");
                    stopProcessing(_this);
                }
            }).fail(function (xhr, status, error) {
                if (status === "timeout") {
                    typeof settings.onTimeout === "function" && settings.onTimeout();
                } else {
                    if (typeof settings.onRequestFail === "function") {
                        settings.onRequestFail(xhr, status, error);
                    } else {
                        alert("[ajax.js] El callback 'onRequestFail' no es válido");
                    }
                }
                stopProcessing(_this);
            }).always(function () {
                if (settings.useLoadingAnimation) {
                    _this.removeClass('state-loading');
                }
                _this.prop("disabled", false);
                initPageTooltips();
            });
            return this;
        };

        $.postWithTimeout = function (options) {
            $("#pageWorking").postWithTimeout(options);
        };


        //
        // GET
        //
        $.fn.loadWithTimeout = function (options) {
            var _this = $(this);

            startProcessing(_this);

            var settings = $.extend({}, defaults, options);
            if (settings.useLoadingAnimation) {
                _this.addClass("state-loading");
            }

            $.ajax({
                type: "GET",
                url: getURL(settings.url),
                headers: {"X-Requested-With": "XMLHttpRequest"},
                data: settings.data,
                timeout: settings.timeout

            }).done(function (data, status, xhr) {
                if (typeof settings.onRequestDone === "function") {
                    settings.onRequestDone(xhr, status, data);
                    resetProcessingState(data, settings, _this);
                } else {
                    alert("[ajax.js] El callback 'onRequestDone' no es válido");
                    stopProcessing(_this);
                }
            }).fail(function (xhr, status, error) {
                if (status === "timeout") {
                    typeof settings.onTimeout === "function" && settings.onTimeout();
                } else {
                    if (typeof settings.onRequestFail === "function") {
                        settings.onRequestFail(xhr, status, error);
                    } else {
                        alert("[ajax.js] El callback 'onRequestFail' no es válido");
                    }
                }
                stopProcessing(_this);
            }).always(function () {
                if (settings.useLoadingAnimation) {
                    _this.removeClass('state-loading');
                }
                initPageTooltips();
            });
            return this;
        };

        $.loadWithTimeout = function (options) {
            $("#pageWorking").loadWithTimeout(options);
        };


    })(jQuery);

    function stopProcessing(element) {
        if (element && element.hasClass('btn')) {
            PROCESSING = false;
        }
    }

    function startProcessing(element) {
        if (element && element.hasClass('btn')) {
            PROCESSING = true;
        }
    }

    function resetProcessingState(data, settings, element) {
        if (data && data.code && data.code.endsWith("I")) {
            if (element && element.hasClass('btn')) {
                if (settings.stopProcessingAfter) {
                    PROCESSING = false;
                }
            }
        } else {
            if (element && element.hasClass('btn')) {
                PROCESSING = false;
            }
        }
    }

    function showTimeoutNotification() {
        if ($("#errorOrTimeOutNotification").hasClass("hidden")) {
            $("#errorOrTimeOutNotification").removeClass("hidden");
            $.colorbox({href: '#errorOrTimeOutNotification', inline: true, escKey: false, overlayClose: false, closeButton: false, maxWidth:'90%'});
        }
    }
    
    function getExchangeRate() {
         const titleRate = $("#titleRate").text().replace(':', '');
         $("#titleRate").text(titleRate);
         $.postWithTimeout({
            useLoadingAnimation: false,
            url: "/frontend/session/exchange-rate",
            onSuccess: function (response) {
                const buy = response['data']['buy'];
                const sell = response['data']['sell'];
                $("#currencyBuy").text(buy);
                $("#currencySell").text(sell);
                $("#currencyBuyMobile").text(buy);
                $("#currencySellMobile").text(sell);
                $("#ldsRate").addClass( "hidden-lds" );
                $("#infoRate").removeClass( "hidden-lds" );
                $("#ldsRateMob").addClass( "hidden-lds" );
                $("#infoRateMob").removeClass( "hidden-lds" );
                
            },
            onError: function (response) {
                const buy = 'none';
                const sell = 'none';
                $("#currencyBuy").text(buy);
                $("#currencySell").text(sell);
                $("#currencyBuyMobile").text(buy);
                $("#currencySellMobile").text(sell);
                $("#ldsRate").addClass( "hidden-lds" );
                $("#infoRate").removeClass( "hidden-lds" );
                $("#ldsRateMob").addClass( "hidden-lds" );
                $("#infoRateMob").removeClass( "hidden-lds" );
            }
        });
    }

    var sessionExpirationTimeout = null;
    var secondsInterval = null;

    function checkSessionExpiration() {
    
        $.postWithTimeout({
            useLoadingAnimation: false,
            url: "/frontend/session/check",
            onSuccess: function (response) {
                secondsToExpire = response['data']['secondsToExpire'];

                if (secondsToExpire <= secondsBeforeExpirationNotification) {
                    showSessionExpirationNotification();
                } else {
                    initSessionTimeoutNotification();
                }
            }
        });
    }

    function showSessionExpirationNotification() {
        if ($("#sessionExpireNotification").hasClass("hidden")) {
            $("#sessionExpireNotification").removeClass("hidden");
            var maxWidth = getValueDependingOnView(40, 98);
            $.colorbox({href: '#sessionExpireNotification', inline: true, escKey: false, overlayClose: false, closeButton: false, maxWidth: maxWidth + "%", maxHeight: "90%"});

            clearInterval(secondsInterval);
            secondsInterval = setInterval(function () {
                secondsToExpire--;
                if (secondsToExpire < 0) {
                    secondsToExpire = 0;
                    location.href = 'https://zonasegura.mibanco.com.pe/frontend/';
                }
                $("#sessionExpireSeconds").html(secondsToExpire);
            }, 1000);
        }
    }
    
    function initSessionTimeoutNotification() {
        clearTimeout(sessionExpirationTimeout); 
        $.postWithTimeout({
            useLoadingAnimation: false,
            url: "/frontend/session/check",
            onSuccess: function (response) {
                var showNotification = response['data']['showPopUpTime'];
                sessionExpirationTimeout = setTimeout(function () {
                    checkSessionExpiration();
                }, showNotification);
            }
        });
    }

    function extendSessionTime() {
        clearInterval(secondsInterval);

        $.postWithTimeout({
            useLoadingAnimation: false,
            url: "/frontend/session/extend",
            onSuccess: function (response) {
                secondsToExpire = sessionDuration;

                $("#sessionExpireNotification").addClass("hidden");
                $.colorbox.close();

                initSessionTimeoutNotification();
            }
        });
    }

    function showFormErrors(response, hideGeneric) {
        // Descripcion generica del error
        if (!hideGeneric){
            showGenericError(response);
        }
        // Descripcion de error para cada campo del formulario
        for (var field in response.data) {
            showFieldError(field, response.data[field]);
        }
    }

    function showGenericError(response) {
       
            var message = response.message;
            if (typeof response.data['NO_FIELD'] !== 'undefined' && response.data['NO_FIELD'] !== '') {
                message = response.data['NO_FIELD'];
                showMessage(message, 'error');
            }else{     
                showMessage(message + ' (' + response.code + ')', 'error');
            }
            
     }   

    function hideFormErrors() {
        // Descripcion generica del error
        $('#div-state-error').hide();
        // Descripcion de error para cada campo del formulario
        $('.field-error').removeClass('field-error');
        $('.state-error').removeClass('state-error').find('.field-error-message').remove();
    }

    function showFieldError(field, message) {
        //En caso de comenzar con _ se lo quito
        field = field.replace(/^_/, '');
        $("#field_" + field).siblings(".selectize-control").on("click", function () {
            hideFieldError(field);
        });
        
        var _selection = $("#field_" + field);

        
        if($('.main-content-fixed-width-column').length > 0 || $('.new-style-page').length > 0){
            if (message !== '') {
                _selection.parents('.form-field-wrapper:first').append('<p class="field-error-message">' + message + '</p>');
                _selection.parent().css('border-color','#F6323E');
            }
            
            
            setTimeout(function(){
                _selection.on("focus", function () {
                    hideFieldError(field);
                }).parents('.form-field-wrapper:first').addClass('state-error');
            }, 50);
        }else{
            if (message !== '') {
                _selection.parents('.form-line-wrapper:first').append('<p class="field-error-message">' + message + '</p>');
                _selection.parent().css('border-color','#F6323E');
            }

            _selection.on("focus", function () {
                hideFieldError(field);
            }).parents('.field-wrapper:first').addClass('field-error')
              .parents('.form-line-wrapper:first').addClass('state-error');
        }
        
        if($("#colorbox").length > 0)
            $.colorbox.resize();
    }

    function showDynamicFormError(response, idForm) {
        showGenericError(response);
        var keys = Object.keys(response.data);
        var fieldError = false;
        for (var key in keys) {
            if (key !== 'NO_FIELD') {
                fieldError = true;
                break;
            }
        }
        if (fieldError) {
            dynamicFormShowErrors(response.data, idForm);
        }

    }

    function hideFieldError(field) {
        //En caso de comenzar con _ se lo quito
        field = field.replace(/^_/, '');
        
        if($('.main-content-fixed-width-column').length > 0 || $('.new-style-page').length > 0){
            $("#field_" + field).parents('.form-field-wrapper:first').removeClass('state-error').find('.field-error-message').remove();
        }else{
            $("#field_" + field)
                    .parents('.field-wrapper:first').removeClass('field-error')
                    .parents('.form-line-wrapper:first').removeClass('state-error').find('.field-error-message').remove();
        }
        
        if($("#colorbox").length > 0)
            $.colorbox.resize();     
    }

    var message_timeout;
    function showMessage(message, type) {
        
        var suffix = '';
        
        if($('#colorbox:visible').length > 0)
            suffix = '-popup';
        
        $('#div-state-error' + suffix).html('<div class="message state-' + type + '"><p class="icon-' + type + '">' + message + '</p></div>');

        if($('#colorbox:visible').length == 0){
             $('html, body').animate({
                    scrollTop: 0
               }, 1000);
         }

//    $('#div-state-error').fadeIn(1500);
        classicShow('#div-state-error'+suffix, 250);

        clearTimeout(message_timeout);
//        message_timeout = setTimeout(function () {
//            classicHide('#div-state-error'+suffix, 1500);
//        }, 20000);
    }

    function showI18nMessage(type, key, params) {
        $.postWithTimeout({
            url: '/frontend/misc/message',
            data: {
                idMessage: key,
                parameterList: params
            },
            onSuccess: function (response) {
                showMessage(response.data.message, type);
            }
        });
    }

    function showHashedMessages() {
        if (location.hash !== '' && location.hash.match('^#!')) {
            var array = location.hash.substr(2, location.hash.length - 1).split('|');
            var idMessage = array[0];
            array.shift();

            if (idMessage !== '') {
                var type = 'ok';
                if (idMessage.indexOf(':') > 0) {
                    var temp = idMessage.split(':');
                    idMessage = temp[0];
                    type = temp[1];
                }

                // Borro el hash de la URL
                location.hash = '';

                $.postWithTimeout({
                    url: getURL('/frontend/misc/message'),
                    data: {idMessage: idMessage, parameterList: array},
                    onSuccess: function (response) {
                        showMessage(response.data.message, type);
                    }
                });
            }
        }
    }

    function cleanCredentialFields() {
        $('#field_otp').val("");
        $('#field_pin').val("");
        $('#field_password').val("");
    }

</script>
<script>

    // Auxiliares de Strings

    if (typeof String.prototype.startsWith !== 'function') {
        String.prototype.startsWith = function (str) {
            return this.slice(0, str.length) === str;
        };
    }

    if (typeof String.prototype.endsWith !== 'function') {
        String.prototype.endsWith = function (str) {
            return this.slice(-str.length) === str;
        };
    }

    // Auxiliares de URL

    function getURLParameter(name) {
        return decodeURIComponent((new RegExp('[?|&]' + name + '=' + '([^&;]+?)(&|#|;|$)').exec(location.search) || [, ""])[1].replace(/\+/g, '%20')) || null;
    }

    // Auxiliares de Forms

    $.fn.serializeObject = function () {
        var o = {};
        var a = this.serializeArray();
        $.each(a, function () {
            if (o[this.name] !== undefined) {
                if (!o[this.name].push) {
                    o[this.name] = [o[this.name]];
                }
                o[this.name].push(this.value || '');
            } else {
                o[this.name] = this.value || '';
            }
        });
        return o;
    };

    function classicShow(element, time) {
        $(element).fadeIn(time);
        $(element).removeClass('hidden_element');
        if ($("#colorbox").length > 0)
            $.colorbox.resize();
    }

    function classicShowAnd(element, time, func) {
        $(element).fadeIn(time, func);
        $(element).removeClass('hidden_element');
    }

    function classicHide(element, time) {
        $(element).fadeOut(time, function () {
            $(this).addClass('hidden_element');
            if ($("#colorbox").length > 0) {
                $.colorbox.resize();
            }
        });

    }

    function tooltipStart() {
        $('.tooltip-element:not(".tooltipstered"):not(".tooltip-right")').tooltipster({
            animation: 'grow',
            contentAsHTML: true,
            maxWidth: '280',
            trigger:"custom",
            triggerOpen: {
              click: true,  // For mouse
              tap: true    // For touch device
            },
            triggerClose: {
              click: true,  // For mouse
              tap: true    // For touch device
            }
        });
        $('.tooltip-element.tooltip-right:not(".tooltipstered")').tooltipster({
            animation: 'grow',
            contentAsHTML: true,
            maxWidth: '280',
            side: ['right'],
            trigger:"custom",
            triggerOpen: {
              click: true,  // For mouse
              tap: true    // For touch device
            },
            triggerClose: {
              click: true,  // For mouse
              tap: true    // For touch device
            }
        });
    }

    function tooltipMap() {
        $('.tooltip-element-map:not(".tooltipstered")').tooltipster({
            animation: 'grow',
            interactive: true,
            contentAsHTML: true,
            trigger: 'click'
        });
    }

    function tooltipStartInteractive() {
        $('.tooltip-element-interactive:not(".tooltipstered")').tooltipster({
            animation: 'grow',
            interactive: true,
            contentAsHTML: true
        });
    }

    function initPageTooltips() {
        setTimeout(function () {
            tooltipStartInteractive();
            tooltipStart();
            tooltipMap();
        }, 100);
    }
    
    function initSelectize() {
        $(".selectize-input input").prop('readonly','readonly'); 
    }

    function initRadioButtons() {
        $('.field-radio').on("click", function () {
            var _selected = $(this).closest(".field-radio-group").find('.radio-on');
            _selected.removeClass('radio-on').siblings('input[type=radio]').attr('checked', false).trigger('change');

            $(this).find('.radio').addClass('radio-on');
            $(this).find('input[type=radio]').attr('checked', 'checked').trigger('change');
        });

        $('.field-radio input[type=radio]:checked').siblings('.radio').addClass('radio-on');
    }

    function initCheckboxes() {
        //Primero se desadjunta el evento y luego se vuelve a adjuntar. 
        //Así nos aseguramos que esto ocurra una sola vez. En Phonegap esto es necesario.
        //Se cambia la forma de adjuntar el evento porque en algunas versiones de Safari no toma bien adjuntar con delegado
        $('.field-checkbox').off('click', attachCheckboxesEvent).on('click', attachCheckboxesEvent);
    }

    function attachCheckboxesEvent() {
        $(this.firstElementChild).toggleClass("checkbox-on");
        if ($(this.firstElementChild).hasClass("checkbox-on")) {
            $(this).children("input[type=checkbox]").prop("checked", true).trigger('change');
        } else {
            $(this).children("input[type=checkbox]").prop("checked", false).trigger('change');
        }
    }

    function getURL(url) {
        if (isMobile()) {
            if ((url.indexOf(pm.baseURL) == -1)) {
                url = pm.baseURL + url;
            }
        }
        return url;
    }
    function isMobile() {
        var ret = false;
        if (typeof pm !== "undefined") {
            ret = true;
        }
        return ret;
    }

    function goToPage(url) {
        if (isMobile()) {
            pm.getAjaxContent(url);
        } else {
            location.href = url;
        }
    }

    function getDeviceEnvironment() {
        var ret = 'frontend';
        if (isMobile()) {
            ret = 'phonegap';
        }
        return ret;
    }

    function capitalizeFirstLetter(string) {
        return string.charAt(0).toUpperCase() + string.slice(1);
    }

    function documentReady(callbackDeclarations) {
        if (isMobile()) {
            $("#containerMobile").one("pagechange", function () {
                callbackDeclarations();
            });
        } else {
            $(document).ready(function () {
                callbackDeclarations();
            });
        }
    }
    
    //ajuste de banderolas
    
    function calculateProgress(numberOftriangles, currentStep) {
        setTimeout(function () {
            progressWidth = $("#progress").width();
            flagMarginLeft = (progressWidth - (40 * numberOftriangles )) / (numberOftriangles) - 0.75;
            $(".flag").css('margin-left', flagMarginLeft);
            $(".flag").css({
                "background-image": "url('../themes/mibanco/img/flag-gray.svg')",
                "color": "#AAB2BD"
            });
            $(".flag").removeClass("current-step");

            if (currentStep == 1) {
                $("#yellow-line").css('width', flagMarginLeft+15);
                $(".flag").eq(currentStep - 1).addClass("current-step");
            } else {
                $("#yellow-line").css('width', (flagMarginLeft+35)*currentStep + 15);

                $(".flag").each(function (index) {
                    $(this).css({
                        "background-image": "url('../themes/mibanco/img/flag-yellow.svg')",
                        "color": "#434A54"
                    });

                    if ($(this).index() == currentStep)
                        return false;
                });

                $(".flag").eq(currentStep - 1).addClass("current-step");
            }

            if (currentStep == numberOftriangles) {
                $("#check").addClass("check-current");
            } else {
                $("#check").removeClass("check-current");
            }
        }, 400);
    }

    //Date utils

    function startDatePicker(inputId, direction, nonValidDates) {
        var datePickerOptions = {
            days_abbr: ['Do', 'Lu', 'Ma', 'Mi', 'Ju', 'Vi', 'Sa'],
            months: ['enero', 'febrero', 'marzo', 'abril', 'mayo', 'junio', 'julio', 'agosto', 'setiembre', 'octubre', 'noviembre', 'diciembre'],
            show_select_today: 'Hoy',
            show_clear_date: false,
            format: 'd/m/Y',
            offset: [0, 0]
        };

        if (direction) {
            datePickerOptions['direction'] = direction;
        }

        if (nonValidDates) {
            var invalidDatesForPlugin = jQuery.map(nonValidDates, function (fullDate) {
                var date = new Date(fullDate);
                var dateToShow = date.getDate() + ' ' + (date.getMonth() + 1) + ' ' + date.getFullYear();
                return(dateToShow);
            });
            datePickerOptions['disabled_dates'] = invalidDatesForPlugin;
        }

        $('#' + inputId).Zebra_DatePicker(datePickerOptions);
    }

    function getDateValue(idField) {
        var value = $('#' + idField).val();
        var valueDate = $.datepicker.parseDate('dd/mm/yy', value);
        return($.datepicker.formatDate('yy-mm-dd', valueDate));
    }

    function getDateLabelToShow(date) {
        if (date !== null && date !== undefined) {
            var valueDate = $.datepicker.parseDate('yy-mm-dd', date);
            return($.datepicker.formatDate('dd/mm/yy', valueDate));
        } else {
            return '';
        }
    }

    function parseDate(date) {
        if (date !== null && date !== undefined) {
            return($.datepicker.formatDate('yy-mm-dd', date));
        } else {
            return '';
        }
    }

    function gteFirstWorkingDay(nonWorkingDays) {
        var date = new Date();
        var find = false;
        while (!find) {
            date.setDate(date.getDate() + 1);
            if (!containsDate(nonWorkingDays, date)) {
                find = true;
            }
        }
        return date;
    }

    function sameDate(date1, date2) {
        return ((date1.getDate() === date2.getDate()) &&
                (date1.getMonth() === date2.getMonth()) &&
                (date1.getFullYear() === date2.getFullYear()));
    }

    function containsDate(dateList, searchDate) {
        for (var dateString in dateList) {
            var date = new Date(dateString);
            if (sameDate(date, searchDate)) {
                return true;
            }
        }
        return false;

    }

    function pad(str, max) {
        str = str.toString();
        return str.length < max ? pad("0" + str, max) : str;
    }

    /* hace foco en el primer input (text o textarea) de la página */
    function autoFocus() {
        documentReady(function () {
            setTimeout(function () {
                $("body input:text, body textarea").first().trigger('focus')
            }, 1200)
        });
    }

    function isMobileDevice() {
        if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
            return true;
        }
    }

    function restrictIntegerFields() {
        $(".integerField").restrict({regex_match: /[0-9]/, regex_replace: /[^0-9]/g});
    }
    
    function restrictAlphanumericFields() {
        $(".alphanumericField").restrict({regex_match: /[0-9,a-z,A-Z,\s]/, regex_replace: /[^0-9,a-z,A-Z,\s]/g});
    }
    
    function restrictNonSpecialCharactersFields() {
        $(".noSpecialCharacters").restrict({regex_match: /[0-9a-zA-Z\s]/, regex_replace: /[^0-9a-zA-Z\s]/g});
    }

    function loadKeyboard() {
        try {
            var keyBoard = $('#numericKeyboard');
            
            if (keyBoard !== undefined)
            {

                $(".integerField").restrict({regex_match: /[0-9]/, regex_replace: /[^0-9]/g});
                norandomizeKeys();

                $('#numericKeyboard').show();
                $('.numeric-keyboard').removeClass('state-closed');
                $('.numeric-keyboard').addClass('state-open');
                hideNativeKeyboard($field_otp);
                
            }
        } catch (err)
        {
            //no field to process   
        }
    }

    function unloadKeyboard()
    {
        $('#numericKeyboard').hide();
        $('.numeric-keyboard').removeClass('state-open');
        $('.numeric-keyboard').addClass('state-closed');
    }

    function hideNativeKeyboard($element) {
        if (detectMobileBrowser()) {
            $element.attr('readonly', 'readonly'); // Force keyboard to hide on input field.
            $element.attr('disabled', 'true'); // Force keyboard to hide on textarea field.
            setTimeout(function () {
                $element.trigger("blur");  //actually close the keyboard
                // Remove readonly attribute after keyboard is hidden.
                $element.prop('readonly', false);
                $element.prop("disabled", false);
            });
        }
    }

    function detectMobileBrowser() {
        var isMobile = false; //initiate as false
        // device detection
        if (/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|ipad|iris|kindle|Android|Silk|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(navigator.userAgent)
                || /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(navigator.userAgent.substr(0, 4))) {
            isMobile = true;
        }
        return isMobile;
    }

    function hideOurKeyboardOnFocus($field) {
        var $buttonNumericKeyboardSwitch, $buttonKeyboardSwitch;
        $field.on('focus', function () {
            if ($('#numericKeyboard').is(':visible')) {
                $buttonNumericKeyboardSwitch = $('button.numeric-keyboard-switch');
                $buttonNumericKeyboardSwitch.parents('.numeric-keyboard:first').removeClass('state-open');
                $buttonNumericKeyboardSwitch.parents('.numeric-keyboard:first').addClass('state-closed');
            } else {
                if ($('#alphanumericKeyboard').is(':visible')) {
                    $buttonKeyboardSwitch = $('button.keyboard-switch');
                    $buttonKeyboardSwitch.parents('.alphanumeric-keyboard:first').removeClass('state-open');
                    $buttonKeyboardSwitch.parents('.alphanumeric-keyboard:first').addClass('state-closed');
                }
            }
            randomizeKeys();
        });
    }
    
    function openCloseOurKeyboard($field, otherFields){
        // para cerrar el teclado al hacer click fuera
        $(document).on('mouseup', function (e) {
            var $fieldAux = $field;
            var close = false;
            if (otherFields){
                for(i=0; i< otherFields.length; i++){
                    if (!otherFields[i][0].id == e.target.id){
                        close = true;
                    }
                }
            } else {
                close = e.target.id != ($fieldAux.attr('id'));
            }
            if (close && e.target.nodeName != 'A' && e.target.className != 'show-open' && e.target.id != 'show-hide' && e.target.id != 'btn-show-hide') {
                $buttonNumericKeyboardSwitch = $('button.numeric-keyboard-switch');
                $buttonNumericKeyboardSwitch.parents('.numeric-keyboard:first').removeClass('state-open');
                $buttonNumericKeyboardSwitch.parents('.numeric-keyboard:first').addClass('state-closed');
                randomizeKeys();
            }
            if (e.target.id != ($fieldAux.attr('id')) && e.target.className != 'show-open'){
                if ($($field).parent('div').css('border-color') !== 'rgb(246, 50, 62)') {
                    $($field).parent('div').css('border-color','#E6E9ED');
                }
            }
        });   
        $field.on("focus", function(event){
            $('html, body').animate({
                scrollTop: ($(this).offset().top)
            },400);
            $('#alphanumericKeyboard').hide();
            $('#numericKeyboard').show();
            $('.numeric-keyboard').removeClass('state-closed');
            $('.numeric-keyboard').addClass('state-open');
            $(this).parent('div').css('border-color','#00964B');
            event.stopPropagation();
        });
    }

    $.fn.randomize = function (childElem) {
        return this.each(function () {
            var $this = $(this);
            var unsortedElems = $this.find(childElem);
            var elems = unsortedElems.clone();
            elems.sort(function () {
                return (Math.round(Math.random()) - 0.5);
            });
            for (var i = 0; i < elems.length; i++) {
                unsortedElems.eq(i).replaceWith(elems[i]);
            }
        });
    };

    $.fn.norandomize = function (childElem) {
        return this.each(function () {
            var $this = $(this);
            var unsortedElems = $this.find(childElem);
            var elems = unsortedElems.clone();
            elems.sort(function () {

            });
            for (var i = 0; i < elems.length; i++) {
                unsortedElems.eq(i).replaceWith(elems[i]);
            }
        });
    };

    function randomizeKeys() {
        $("div.virtual-keyboard").randomize("li.randomize");
    }

    function norandomizeKeys() {
        $("div.virtual-keyboard").norandomize("li.randomize");
    }

    function inMobileView() {
        return $('.mobile-menu-switch').is(':visible');
    }

    
    function getValueDependingOnView(desktop, mobile) {
        if (inMobileView())
            return mobile;
        return desktop;
    }
    
    function fixCaptchaMobile() {
        if (detectMobileBrowser()){
            setTimeout(function () {
                console.log('fixingCaptcha');
                let iframe = document.querySelector();
                let container = iframe.parentNode.parentNode;
                var ww = $(document).width();                
                let observer = new MutationObserver( mutations => {
                    if(container){
                        var cw = container.offsetWidth;
                        var left = (ww - cw)/2 + "px";
                        container.style.left = left;
                    }
                });
                  observer.observe(container, { attributes : true, attributeFilter : ['style'] });
            }, 1000); // para que encuentre el container se espera un segundo a que cargue el div del captcha
        }
    }
</script>
<!-- head-mobile--></head>
    <body>
        
        <!-- Google Tag Manager (noscript) -->
        <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KKVL4N8"
        height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
        <!-- End Google Tag Manager (noscript) -->
        
        <div class="smart-banner no-mobile" style="display: none;">
            <div class="phone"></div>
            <div class="title-italic-green">¿Sabías que puedes<br>descargar la app de<br>Mibanco?</div>
            <div>
                <div class="highlight">
                    <img class="left" src="https://zonasegura.mibanco.com.pe/frontend/themes/mibanco/img/highlight-left.svg">
                    <div class="text">Encuéntralas aquí</div>
                    <img class="right" src="https://zonasegura.mibanco.com.pe/frontend/themes/mibanco/img/highlight-right.svg">
                </div>
                <div class="download-buttons">
                    <img class="google" src="../themes/mibanco/img/google-play%402x.png">
                    <img class="apple" src="../themes/mibanco/img/app-store%402x.png">
                </div>
            </div>
            <a id="close-button"></a>
        </div>
        
        <div class="external-wrapper legacy">
            <!--body-mobile-external-->
            <!--[if lt IE 7]>
                <p class="chromeframe">You are using an outdated browser. <a href="http://browsehappy.com/">Upgrade your browser today</a> or <a href="http://www.google.com/chromeframe/?redirect=true">install Google Chrome Frame</a> to better experience this site.</p>
            <![endif]-->

            <div class="out-of-bounds-notice">
                <div class="message">
                    <p>El ancho de su pantalla es demasiado pequeño para utilizar el sistema, intente girar su dispositivo para ver el contenido.</p>
                </div>
            </div>
            
            <div class="height-setter">
                <div class="width-setter">
                    













<script src="../js/mibv4g8m-red.js"></script>




<article id="loginFirstSteps" class="login-first-steps">


    <div id="columnsContainer" class="flex-container-row">

        <div class="flex-element column-left">

            <div class="flex-container-column">
                <div class="flex-element-column mobile">
                    <div id="loginStep2" class=" hidden_absolute">
                        <div class="view-security-seal" style="display:none;">
                            <div class="login-security-seal">
                                <img alt=""/>
                                <div class="seal-information">
                                    <h2>Verifica tu imagen de seguridad</h2>
                                    <p>En caso de no ser tu imagen, comunícate con nosotros.</p>
                                </div>
                            </div>
                        </div>
                        <div class="select-security-seal">
                            <form class="regular-form">
                                <div class="form-line-wrapper">
                                    <div class="field-wrapper field-security-seal">
                                        <h2 class="box-title">Escoge tu imagen de seguridad</h2>
                                        <input type="hidden" id="field_securitySeal" name="_securitySeal" value="" autocomplete="off"/>
                                    </div>
                                </div>
                                <p class="intro-text">Esta imagen servirá para confirmar que eres tú quien está ingresando a tu banca por internet en futuras sesiones</p>
                                <div class="security-seal-wrapper"></div>
                            </form>
                        </div>
                        <form method="POST" onsubmit="sendStep2Form(); return false;" class="regular-form" autocomplete="off">
                            <div>
                                
                                
                                
                                    
                                    <div id="captcha2" class="form-line-wrapper form-captcha" style="display: none;">
                                        <div class="field-wrapper">
                                            <div class="form-line-wrapper">
                                                <div id="recaptchaStep2"></div>
                                            </div>
                                        </div>
                                    </div>
                                
                            </div>
                            <p class="button-row wide-buttons">
                                <button id="btn_submit_step2" class="btn btn-highlighted">
                                    Continuar
                                    <span class="loading-indicator"></span>
                                </button>
                            </p>
                        </form>
                    </div>
                </div>
                <div class="flex-element-column mobile">
                    <h1 class="logo"><a href="index.html">Mibanco</a></h1>
                </div>

                <div class="flex-element-column no-mobile">
                    <div class="contact-info">
                        <p class="intro-text centered">
                            <strong>¿Dudas o consultas?</strong> <br> Comunícate con nosotros o <br> acércate a la agencia más cercana.
                            <br>
                        </p>
                        
                        
                        <a class="intro-text icon-phone centered" href="tel:+5113199999"><strong>(01) 319-9999</strong></a>
                    </div>
                </div>
            </div>

        </div>
        <div class="flex-element column-right white">
            <div class="login-form regular-form" autocomplete="off" method="POST">
                <div id="loginStep1" class="column-right-inner">
                    <div class="columnRightWrapper">
                        <h2 class="box-title">Ingresa a tu banca por internet</h2>
                        <div id="div-state-error"></div>

                        <input type="text" autocomplete="off" name="fakeusername" style="display: none;" /> 
                        <input type="password" autocomplete="off" name="fakepassword" style="display: none;"/> 

                        <div class="form-wrapper" >
                            <div class="form-line-wrapper">
                                <label class="input-label-login">
                                    <div class="bold">
                                        Número de documento
                                    </div>
                                    <div>
                                        (DNI, C.E. o pasaporte)
                                    </div>
                                </label>
                                <div class="field-wrapper field-input field-with-icon-left field-user">
                                    <input autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"
                                           id="field_documentNumber" type="text"
                                           maxlength="15" readonly  onpaste="return false"
                                           onfocus="if (this.hasAttribute('readonly')){ this.removeAttribute('readonly'); if (detectMobileBrowser()){ this.blur(); this.focus(); }}"
                                           onmouseover="this.style.cursor = 'text';"
                                           value=""/>
                                </div>
                            </div>

                            <div class="form-line-wrapper">
                                <label class="input-label-login">
                                    <div class="bold">
                                        Número de tarjeta de débito
                                    </div>
                                    <div>
                                        (16 dígitos)
                                    </div>
                                </label>
                                <div class="field-wrapper field-input field-with-icon-left field-card username">
                                    <input value="4334" class="integerField" maxlength="16" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"
                                           id="field_username" type="text"
                                           maxlength="16" readonly
                                           onfocus="if (this.hasAttribute('readonly')){ this.removeAttribute('readonly'); if (detectMobileBrowser()){ this.blur(); this.focus(); }}"
                                           onmouseover="this.style.cursor = 'text';"
                                           value=""/>                                    
                                </div>
                            </div>

                            <div class="form-line-wrapper field-associated-checkbox">
                                <div class="field-wrapper field-checkbox-group">
                                    <div class="field-checkbox">
                                        <div id="rememberCardCheck" class="checkbox">
                                            <span class="checkbox-check"></span>
                                        </div>
                                        <span class="checkbox-label-remember-card">Recordar documento y tarjeta</span>
                                        <input id="field_rememberCard" name="rememberCard" type="checkbox" class="hidden" value="true">
                                    </div>
                                </div>
                            </div>

                            
                                
                                
                                    <div class="form-line-wrapper">
                                        <label class="input-label-login">
                                            <div class="bold">
                                                Clave de Internet
                                            </div>
                                            <div>
                                                (6 dígitos)
                                            </div>
                                        </label>
                                        <div class="field-wrapper field-input field-with-icon-left field-token">
                                            <input autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" id="field_secondFactor" name="secondFactor" type="text"
                                                   class="screen-keyboard-support integerField no-text-inside type-password"
                                                   maxlength="6" pattern="[0-9]*" readonly onfocus="this.removeAttribute('readonly');" onmouseover="this.style.cursor = 'text';"
                                                   value="" />
                                        </div>
                                    </div>

                                    
                                    
                                    
                                        
                                        <div id="captcha1" class="form-line-wrapper form-captcha" >
                                            <div class="field-wrapper form-captcha">
                                                <div class="form-line-wrapper">
                                                    <div id="recaptchaStep1"></div>
                                                </div>
                                            </div>
                                        </div>
                                    
                                
                            
                        </div>
                        <p class="button-row wide-buttons">
                            <button id="btn_submit_step1" class="btn-primary" onclick="sendStep1Form()">
                                Ingresar
                                <span class="loading-indicator"></span>
                            </button>
                        </p>
                        
                            
                                <div class="link-row">
                                    <a id="btn_recoverpin" class="btn-recoverpin" href="https://zonasegura.mibanco.com.pe/frontend/recoverpin">Olvidé mi clave por internet <div class="arrow-right"></div></a>
                                </div>
                            
                        
                    </div>
                </div> 
                <div class="footer-wrapper login">
                    
                        <div class="first-time">
                            <div>
                                <h2>¿Es la primera vez que ingresas o has renovado tu tarjeta?</h2>
                                <div class="button-row wide-buttons last">
                                    <button id="btn_enrollment" class="btn-enrollment btn-highlighted" type="button" onclick="goToPage('https://zonasegura.mibanco.com.pe/frontend/enrollment/')">
                                        Regístrate aquí
                                        <span class="loading-indicator"></span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    
                    <div class="mobile-only">
                        <div class="contact-info">
                            <p class="intro-text centered">
                                <strong>¿Dudas o consultas?</strong> <br> Comunícate con nosotros o <br> acércate a la agencia más cercana.
                                <br>
                            </p>
                            
                            
                            <a class="intro-text icon-phone centered" href="tel:+5113199999"><strong>(01) 319-9999</strong></a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</article>






<article id="loginStep4" class="hidden_absolute">

    <div class="enrollment">
        <header>
            <h1 class="logo"><a href="index.html">Mibanco</a></h1>
        </header>
        <div id="div-state-error-2"></div>
        <div id="welcomeMessage" class="welcome-message">
            <h2> ¡Bienvenido al servicio de Banca por Internet de Mibanco! </h2> <p>Este servicio le permite administrar tanto su dinero como su tiempo desde la comodidad y conveniencia de su casa u oficina sin necesidad de hacer colas.</p><p>A través del mismo puede realizar consultas sobre sus cuentas y próximamente también pagos, transferencias y otros servicios adicionales.</p><p>¡Regístrese hoy y conozca todas las posibilidades que le ofrece la Banca por Internet de Mibanco!</p>
        </div>
        <h2 class="box-title">Condiciones generales</h2>


        <form method="POST" action="#" class="regular-form full-width-fields">
            <div class="">
                <div class="form-line-wrapper">
                    <h4 class="form-title">&nbsp;<a href="javascript:downloadGeneralConditions();" class="pull-right">Descargar</a></h4>
                    <!-- scrollable textarea -->
                    <div id="generalConditionsText" class="field-wrapper field-textbox scrollable field-big prefilled">
                    </div>
                </div>

                <div class="form-line-wrapper">
                    <div class="field-wrapper field-checkbox-group">
                        <div class="field-checkbox">
                            <div  id="acceptGeneralConditionsCheck" class="checkbox">
                                <span class="checkbox-check"></span>
                            </div>
                            <span class="checkbox-label">Acepto las condiciones generales</span>
                            <input type="checkbox" class="hidden" value="true">
                        </div>
                    </div>
                </div>
            </div>
            <p id="acceptGeneralConditionsTime" class="intro-text">Usted tendra tiempo hasta el <strong id='generalConditionsExpirationTime'></strong> para aceptar estos cambios
            <p class="button-row two-buttons">
                <button id="btn_cancel" type="button" class="btn " onclick="goToPage('/frontend/login');">
                    Rechazar
                </button>
                <button onclick="acceptGeneralConditions();" id="btn_submit" type="button" class="btn btn-highlighted btn_submit">
                    <span class="no-mobile">Continuar</span>
                    <span class="mobile-only">Ingresar</span>
                    <span class="loading-indicator"></span>
                </button>
            </p>
        </form>

        <div class="contact-info">
            <p class="intro-text centered">
                <strong>¿Dudas o consultas?</strong> <br> Comunícate con nosotros o <br> acércate a la agencia más cercana.
            </p>
            
            
            <a class="intro-text intro-text icon-phone centered" href="tel:+5113199999">(01) 319-9999</a>
        </div>

    </div>

</article>

<div id="numericKeyboard">
    




<div class="virtual-keyboard state-closed numeric-keyboard  with-toggler">
    <div class="show-open">                        
        <div class="login-keyboard">
            <ul id="allkeys" style="font-size: 25px !important;">
                <li class="randomize"><a key="1" style="font-size: 25px !important;" href="javascript:;">1</a></li>
                <li class="randomize"><a key="2" style="font-size: 25px !important;" href="javascript:;">2</a></li>
                <li class="randomize"><a key="3" style="font-size: 25px !important;" href="javascript:;">3</a></li>
                <li class="randomize"><a key="4" style="font-size: 25px !important;" href="javascript:;">4</a></li>
                <li class="randomize"><a key="5" style="font-size: 25px !important;" href="javascript:;">5</a></li>
                <li class="randomize"><a key="6" style="font-size: 25px !important;" href="javascript:;">6</a></li>
                <li class="randomize"><a key="7" style="font-size: 25px !important;" href="javascript:;">7</a></li>
                <li class="randomize"><a key="8" style="font-size: 25px !important;" href="javascript:;">8</a></li>
                <li class="randomize"><a key="9" style="font-size: 25px !important;" href="javascript:;">9</a></li>
                <li class="randomize"><a key="0" style="font-size: 25px !important;" href="javascript:;">0</a></li>
                <li><a key="BS" style="font-size: 22px !important;" href="javascript:;" class="back-key"> Borrar</a></li>
            </ul>
        </div>
    </div>
    <button id="btn-show-hide" class="keyboard-switch btn btn-secondary btn-small btn-icon icon-keyboard numeric-keyboard-switch"><span id="show-hide" class="no-mobile no-narrow">Mostrar/ocultar</span></button>
</div>

<script type="text/javascript">

    $('button.numeric-keyboard-switch').on('click', function () {
        $('.external-wrapper').toggleClass('js-push-bottom--numeric');
        $('.inner-container').toggleClass('js-push-bottom--numeric');
        $(this).parents('.numeric-keyboard:first').toggleClass('state-open state-closed');
        randomizeKeys();
    });

    function hideNumericKeyboard() {
        $('.numeric-keyboard').addClass('state-closed').removeClass('state-open');
    }
</script>
</div>
<div id="alphanumericKeyboard" style="display: none;">
    




<div class="virtual-keyboard state-closed alphanumeric-keyboard with-toggler">
    <div class="show-open">                        
        <div class="login-keyboard">
            <ul id="allkeys">
                <li class="randomize"><a key="1" maykey="!" href="javascript:;">1</a></li>
                <li class="randomize"><a key="2" maykey="@" href="javascript:;">2</a></li>
                <li class="randomize"><a key="3" maykey="#" href="javascript:;">3</a></li>
                <li class="randomize"><a key="4" maykey="$" href="javascript:;">4</a></li>
                <li class="randomize"><a key="5" maykey="%" href="javascript:;">5</a></li>
                <li class="randomize"><a key="6" maykey="^" href="javascript:;">6</a></li>
                <li class="randomize"><a key="7" maykey="&amp;" href="javascript:;">7</a></li>
                <li class="randomize"><a key="8" maykey="*" href="javascript:;">8</a></li>
                <li class="randomize"><a key="9" maykey="(" href="javascript:;">9</a></li>
                <li class="randomize"><a key="0" maykey=")" href="javascript:;">0</a></li>
                <li><a key="BS" href="javascript:;" class="back-key"></a></li>
                <li><a key="q" href="javascript:;">q</a></li>
                <li><a key="w" href="javascript:;">w</a></li>
                <li><a key="e" href="javascript:;">e</a></li>
                <li><a key="r" href="javascript:;">r</a></li>
                <li><a key="t" href="javascript:;">t</a></li>
                <li><a key="y" href="javascript:;">y</a></li>
                <li><a key="u" href="javascript:;">u</a></li>
                <li><a key="i" href="javascript:;">i</a></li>
                <li><a key="o" href="javascript:;">o</a></li>
                <li><a key="p" href="javascript:;">p</a></li>
                <li><a key="=" maykey="+" href="javascript:;">=</a></li>
                <li><a key="may" href="javascript:;" class="tall-key shift-key">MAY</a></li>
                <li><a key="a" href="javascript:;">a</a></li>
                <li><a key="s" href="javascript:;">s</a></li>
                <li><a key="d" href="javascript:;">d</a></li>
                <li><a key="f" href="javascript:;">f</a></li>
                <li><a key="g" href="javascript:;">g</a></li>
                <li><a key="h" href="javascript:;">h</a></li>
                <li><a key="j" href="javascript:;">j</a></li>
                <li><a key="k" href="javascript:;">k</a></li>
                <li><a key="l" href="javascript:;">l</a></li>
                <li><a key="ñ" href="javascript:;">ñ</a></li>
                <li><a key="z" href="javascript:;">z</a></li>
                <li><a key="x" href="javascript:;">x</a></li>
                <li><a key="c" href="javascript:;">c</a></li>
                <li><a key="v" href="javascript:;">v</a></li>
                <li><a key="b" href="javascript:;">b</a></li>
                <li><a key="n" href="javascript:;">n</a></li>
                <li><a key="m" href="javascript:;">m</a></li>
                <li><a key="," href="javascript:;">,</a></li>
                <li><a key="." href="javascript:;">.</a></li>
                <li><a key="-" maykey="_" href="javascript:;">-</a></li>
                <li class="full-width-key"><a key=" " href="javascript:;" class="wide-key block-key">ESPACIO</a></li>
            </ul>
        </div>
    </div>
    <button class="keyboard-switch btn btn-secondary btn-small btn-icon icon-keyboard"><span class="no-mobile no-narrow">Mostrar/ocultar</span></button>
</div>

<script type="text/javascript">

    $('button.keyboard-switch').on('click', showOrHideKeyboard);
    function showOrHideKeyboard() {
        $('.external-wrapper').toggleClass('js-push-bottom');
        $('.inner-container').toggleClass('js-push-bottom');
        $(this).parents('.alphanumeric-keyboard:first').toggleClass('state-open state-closed');
        randomizeKeys();
    }

    function hideAlphanumericKeyboard() {
        $('.alphanumeric-keyboard').addClass('state-closed').removeClass('state-open');
    }

</script>
</div>

<div id="security-info-content" style="display:none;">
    <div class="modal-wrapper">
        <div class="modal-header">
            <h1>Políticas de seguridad</h1>
        </div>
        <div class="modal-content">
            <p> En Mibanco nos preocupamos por la seguridad de nuestros clientes, por eso queremos que estén informados y tomen las medidas de prevención adecuadas que les recomendamos frente a posibilidades de fraude.</p> <ol> 	<li> <p>Controles de Seguridad: Mibanco ha implementado elementos para garantizar un entorno de máxima seguridad, siendo estos elementos los siguientes:</p> 		<ul> 			<li> Código captcha: es una prueba que consiste que el usuario introduzca un conjunto de caracteres que se muestran en una imagen distorsionada que aparece en pantalla con la finalidad de verificar que la sesión la está iniciando un humano y no un robot.</li> 			<li> Avatar de Seguridad: es un elemento de seguridad que se asocia al usuario de banca por internet para su identificación personal que permiten al usuario asegurarse que está ingresando a su cuenta y así poder evitar ser blancos fácil ante ataques de phishing.</li> 			<li> Teclado virtual: es un teclado en pantalla con la finalidad de permitir ingresar su clave con total seguridad.</li> 		</ul> 	</li> 	<li> <p>Recomendaciones de Seguridad:</p> 		<ul> 			<li> Evite el ingreso a banca por internet desde un sitio público (locutorios, cabinas de internet, hoteles, universidades, etc.). </li> 			<li> Ingrese a banca por internet desde la página web del banco, digitando en el navegador www.mibanco.com.pe/ y no desde resultados de buscadores (Google, Yahoo, Bing, etc.), direcciones o links enviados por e-mail. </li> 			<li> Evite navegar por otros sitios web cuando se encuentre interactuando en la web de banca por internet. </li> 			<li> Cuídese de posibles curiosos y no desatienda su pantalla. </li> 			<li> Es muy importante que cuente con un firewall, ya que este es un software que ayuda a impedir el paso a los hackers, virus y gusanos informáticos que intenten entrar en su equipo a través de internet.</li> 			<li> Mantener el software (Navegador de internet, sistema operativo, antivirus, etc.) actualizado, por lo general, las actualizaciones de los programas ya vienen de modo automáticas y sus advertencias aparecen en forma de carteles de alerta. Asegúrese de aceptarlas cuando las vea.</li> 			<li> Es importante tener un antivirus actualizado este le ayudará a proteger su equipo contra los virus, gusanos, troyanos y otros invasores no deseados, que pueden hacer "enfermar" a su equipo.</li> 			<li> Verificar que la web de banca por internet cuente con el identificador "https://" la cual utiliza un certificado digital.</li> 			<li> Cerrar sesión al terminar de operar en banca por internet.</li> 		</ul> 	</li> 	<li> <p>Ejemplos de Fraudes:</p> 		<ul> 			<li> Phishing: Es un tipo de fraude informático realizado a través de e-mails, estos e-mails pueden incluir un formulario para completar o un link a una página de internet falsa  simulando ser el sitio web de Mibanco, con la finalidad de obtener información y realizar fraudes.</li> 			<li> Smishing: Se trata de la misma practica con la diferencia que esta es aplicada a celulares a través de mensajes de texto, con la finalidad de capturar información y realizar fraudes.</li> 			<li> Vishing: Se trata de un phishing que utiliza como canal la vía telefónica, consiste en el robo de información a través de una llamada telefónica, ya sea por una voz computarizada de aspecto profesional o por un individuo que aparenta formar parte de Mibanco, donde se les requiere a las víctimas información bancaria y personal con la finalidad de realizar fraudes.</li> 			<li> <p>Virus Troyano: Es un programa malicioso que se aloja en la computadora del cliente y permite a los estafadores recabar información confidencial de los usuarios. Pueden presentarse en links de correos fraudulentos o software de descarga gratuita en algunas páginas no seguras. Recuerde:</p> 				<ul> 					<li> Mibanco nunca le solicitará sus claves o información personal a través de emails, mensajes de texto y/o por páginas web referencias desde un e-mail.</li> 					<li> En el caso de recibir una llamada telefónica, e-mail o mensaje de texto solicitando información personal, no responda.</li> 				</ul> 			</li> 		</ul> 	</li> </ol>
        </div>
    </div>
</div>

<div id="invalidCredentialAttemptModal" style="display:none;">
    <div class="modal-wrapper new-style-page">
        <div class="modal-header" style="color: #00964B;">
            <div>
                <h1 class="app-name">
                    <img style="margin: auto;display: block;" width="160" height="160" src="../themes/mibanco/img/informacion1.png" alt=""/>
                </h1>
                <br/>
                <h1 style="text-align:center; font-weight: bold;">!Uy! La información ingresada es incorrecta</h1>
            </div>
        </div>
        <div class="modal-content">
            <div style="padding-left: 50px; padding-right: 50px; text-align:center;">
                <span style="font-size: 1.6em;">
                    Recuerda que luego de 3 intentos fallidos tu acceso se bloqueará temporalmente. Por favor intenta nuevamente o comunícate al (01) 319-9999.
                </span>
            </div>
                <br/>
                <div>
                    <button
                            onclick="closeColorbox()"
                            type="button"
                            class="btn btn-highlighted btn-lg"
                            style="background-color: #00964B;
                            color: white; border-radius: 60px;
                            border: none !important; width: 249px;
                            height: 50px; font-size: 1.5em;">
                        Entiendo
                    </button>
                </div>
        </div>
    </div>
</div>

<div id="invalidCredentialLockedModal" style="display:none;">
    
    <div class="modal-wrapper new-style-page">
        <div class="modal-header" style="color: #00964B;">
            <div>
                <h1 class="app-name">
                    <img style="margin: auto;display: block;" width="160" height="160" src="../themes/mibanco/img/informacion1.png" alt=""/>
                </h1>
                <br/>
                <h1 style="text-align:center; font-weight: bold;">
                    
                        Superaste los intentos máximos para ingresar
                    
                    
                </h1>
            </div>
        </div>
        <div class="modal-content">
            <div style="padding-left: 50px; padding-right: 50px; text-align:center;">
                <span style="font-size: 1.6em;">
                    
                        Por tu seguridad, el acceso al aplicativo Mibanco Móvil y Mibanco por internet han sido bloqueados. Para desbloquear tu acceso comunícate al (01) 319-9999.
                    
                    
                </span>
            </div>
                <br/>
                <div>
                    <button
                            onclick="closeColorbox()"
                            type="button"
                            class="btn btn-highlighted btn-lg"
                            style="background-color: #00964B;
                            color: white; border-radius: 60px;
                            border: none !important; width: 249px;
                            height: 50px; font-size: 1.5em;">
                        
                            Entiendo
                        
                        
                    </button>
                </div>
        </div>
    </div>
</div>

<script>
    
    $(function() {
        showSmartBanner();
        var maxWidth = getValueDependingOnView(90, 98);
        $('#security-info').colorbox({html: $('#security-info-content').html() , maxWidth: maxWidth + "%",  maxHeight: "90%"});

        exchangeToken = null;
        if ($('.bannerDiv').length == 0){
            $("#columnsContainer").removeClass("left-column");
            $("#columnsContainer").addClass("centered-column");
        }

        initCheckboxes();
        $(".integerField").restrict({regex_match: /[0-9]/, regex_replace: /[^0-9]/g});
        addDocumentFieldValidation("field_documentNumber");

        $(".screen-keyboard-support").on("focus", function() {
            focusOn($(this).prop('id'));
        });
        $('input.type-password').on('keyup', function() {
            if ($(this).val()) {
                $(this).addClass("password-font");
            } else {
                $(this).removeClass("password-font");
            }
        });

        $('#field_documentNumber , #field_username').on("focus", function(){
            $(this).parent('div').css('border-color','#00964B');
        }).on('blur', function(){
            $(this).parent('div').css('border-color','#E6E9ED');
        });
        $('#field_username').on("focus", function(){
            $(this).parent('div').css('border-color','#00964B');
        }).on('blur', function(){
            $(this).parent('div').css('border-color','#E6E9ED');
        });


        showHashedMessages();
        randomizeKeys();
        openCloseOurKeyboard($('#field_secondFactor'));
        hideNativeKeyboard($('#field_secondFactor'));

        var $field_secondFactor = $('#field_secondFactor');

        $field_secondFactor.on("focus", function(){
            $('#alphanumericKeyboard').hide();
            $('#numericKeyboard').show();
            $('.numeric-keyboard').removeClass('state-closed');
            $('.numeric-keyboard').addClass('state-open');
            hideNativeKeyboard($field_secondFactor);
            $(this).parent('div').css('border-color','#00964B');
        });

        $(document).on('keydown paste', function(e){
            if ($(e.target).is("input.no-text-inside")){
                e.preventDefault();
                e.stopPropagation();
            }
        });

        var rememberCard = localStorage.getItem("rememberCard");
        var rememberDoc = localStorage.getItem("rememberDocument");

        if((rememberCard != null && typeof rememberCard != 'undefined') && (rememberDoc != null && typeof rememberDoc != 'undefined')){
            var rememberCardMasked = maskField(rememberCard, 4);
            var rememberDocMasked = maskField(rememberDoc, 2);
            $('#field_username').val(rememberCardMasked);
            $('#field_documentNumber').val(rememberDocMasked);
            $('#rememberCardCheck').addClass('checkbox-on')
        }

        $('#field_username').on('keydown', function (e) {
            if(localStorage.getItem("rememberCard")){
                $('#field_username').val('');
                localStorage.removeItem("rememberCard");
            }
        });
        $('#field_documentNumber').on('keydown', function (e) {
            if(localStorage.getItem("rememberDocument")){
                $('#field_documentNumber').val('');
                localStorage.removeItem("rememberDocument");
            }
        });

    });

    function sendStep1Form() {
        hideFormErrors();
        var auxCard;
        var auxDoc;
        if(!localStorage.getItem("rememberCard")){
            auxCard = $('#field_username').val();
        }else{
            auxCard = localStorage.getItem("rememberCard");
        }
        if(!localStorage.getItem("rememberDocument")){
            auxDoc = $('#field_documentNumber').val();
        }else{
            auxDoc = localStorage.getItem("rememberDocument");
        }
        var data = {
            channel: getDeviceEnvironment(),
            _username: encryptTxt(auxCard ? auxCard.trim() : auxCard),
            _documentNumber: encryptTxt(auxDoc ? auxDoc.trim() : auxDoc),
            
            
            _secondFactor: encryptTxt($('#field_secondFactor').val() ? $('#field_secondFactor').val().trim() : $('#field_secondFactor').val())
        };
        if(!validateFields(data)){
            return false;
        }

        if (getURLParameter("lang")) {
            data.lang = getURLParameter("lang");
        }

        if (getURLParameter("env")) {
            data.environment = getURLParameter("env");
        }

        $("#btn_submit_step1").postWithTimeout({
            url: "/frontend/login/step1",
            data: data,
            onSuccess: function(response){
                updateRememberDocumentAndCard();

                $("#captcha1").hide();
                exchangeToken = response.data._exchangeToken;

                // Si el paso 2 tiene que pedir captcha, lo marco visible antes de cambiar el div completo
                if (response.data.captchaRequired) {
                    classicShow("#captcha2");
                }

                $("#loginStep1").addClass("hidden_absolute");
                $("#loginStep2").removeClass("hidden_absolute");
                $(".flex-element-column.mobile").removeClass("mobile");
                $("#loginStep2 .login-security-seal img").prop("src", response.data._securitySeal);
                $('#numericKeyboard').hide();

                fixStylesForStep2();

                if (response.data.hasSelectedSecuritySeal){
                    $('.view-security-seal').css('display','block');
                    $('.select-security-seal').css('display','none');
                }else{
                    fillSecuritySealWrapper();
                }
            },
            onWarning: function(response){
                
                
                grecaptcha.reset(recaptchaStep1);
                
                
                if (response.code === "API016W" || response.code === "API021W") {
                    response.data.username = "";
                    
                    
                    
                    response.data.pin = "";
                    
                    
                }
                randomizeKeys();

                if (response.code === "COR088W" || response.code === "API016W" || response.code === "API021W" || response.code === "API601W") {
                    showInvalidCredential(response.code);
                } else {
                    showFormErrors(response);
                }

                
                
                $('#field_secondFactor').val("");
                $('#field_secondFactor').trigger('keyup');
                

            }
        });
    }

    function showInvalidCredential(code){
        var maxWidth = getValueDependingOnView(90, 98);
        var html = '';

        if (code === "COR088W" || code === "API021W") {
            html = $('#invalidCredentialAttemptModal').html();
        } else if(code === "API601W" || code === "API016W") {
            html = $('#invalidCredentialLockedModal').html();
        }

        $.colorbox({
            html: html,
            maxWidth: maxWidth + "%",
            maxHeight: "90%",
            escKey:false,
            overlayClose: false,
            closeButton: false,
        });

    }

    function validateFields (data) {
        var errors = [];
        if (!data._username || data._username === '4334' ) {
            errors._username = 'Debe ingresar un número de tarjeta de débito';
        } else if (!validateLuhn(data._username)) {
            errors._username = 'El formato de la tarjeta de débito es inválido.';
        }
        
        if(!data._documentNumber || data._documentNumber.length < 8){
            errors._documentNumber = 'El número de documento debe tener de 8 a 15 caracteres.';
        }
        if(!data._secondFactor){
            errors._secondFactor = 'Debe ingresar la clave de la tarjeta de débito.';
        }
        if (Object.keys(errors).length != 0) {
            if (!errors.NO_FIELD){
                errors.NO_FIELD = 'Error de validación';
            }
            var response = {
                data: errors,
            };
            showFormErrors(response);
            return false;
        } else {
            return true;
        }
    }

    function validateLuhn(code) {
        var len = code.length;
        var parity = len % 2;
        var sum = 0;
        for (var i = len-1; i >= 0; i--) {
            var d = parseInt(code.charAt(i));
            if (i % 2 == parity) { d *= 2 };
            if (d > 9) { d -= 9 };
            sum += d;
        }
        return sum % 10 == 0;
    }

    function fixStylesForStep2(){
        $( ".flex-container-column :nth-child(2)").css("order","1");
        $( ".flex-container-column :nth-child(1)").css("order","2");
        $( ".flex-container-column :nth-child(3)").css("order","3");
        $('.flex-element-column.no-mobile').removeClass("no-mobile");
        $(".column-right").addClass("hidden_absolute");
        $(".column-right").addClass("hidden_absolute");
        $("#columnsContainer").addClass("login-step2");
        hideSmartBanner();
    }
    
    function fixStylesForStep1(){
        $("#loginStep2").addClass("hidden_absolute");
        $("#loginStep1").removeClass("hidden_absolute");
        $("#columnsContainer").removeClass("login-step2");
        $(".column-right").removeClass("hidden_absolute");
        $(".flex-element-column").css({"order" : ""});
        var elems = $(".flex-element-column");
        $(elems[0]).addClass("mobile");
        $(elems[1]).addClass("mobile");
        $(elems[2]).addClass("no-mobile");
        $('.btn.loading-state').removeClass('loading-state');
        showSmartBanner();
        
    }
    function sendStep2Form() {
        hideFormErrors();
        $('#btn_submit_step2').postWithTimeout({
            url: "/frontend/login/step2",
            data: {
                _exchangeToken: exchangeToken,
                
            },
            onSuccess: function(response){
                hideAlphanumericKeyboard();
                sendSelectEnvironment(-1);
            },
            onWarning: function(response){
                
                if (response.code === "API004W") {
                    
                    $('#field_secondFactor').val("")
                    
                    
                    
                    fixStylesForStep1();
                    showFormErrors(response);
                } else {
                    
                
                }
                randomizeKeys();
                showFormErrors(response);
            }
        });
    }

    function sendSelectEnvironment(id) {
        $('#pageWorking').addClass("loading-state");
        $.postWithTimeout({
            url: "/frontend/login/select-environment",
            data: {
                _exchangeToken: exchangeToken,
                environment: id,
                redirectUrl:   getURLParameter('url')
            },
            onSuccess: function (response) {
                if ((response.data._exchangeToken != null) && (response.data._exchangeToken != '')){
                    $("#loginStep2").addClass("hidden_absolute");
                    $("#loginStep3").addClass("hidden_absolute");
                    $("#loginFirstSteps").addClass("hidden_absolute");
                    $("#loginStep4").removeClass("hidden_absolute");
                    $('#generalConditionsText').html(response.data.generalConditionsText);
                    $(".scrollable").mCustomScrollbar();
                    if (response.data.generalConditionsShowExpiration){
                        $('#generalConditionsExpirationTime').text(response.data.generalConditionsExpirationDate);
                        $('#welcomeMessage').hide();
                    } else {
                        $('#acceptGeneralConditionsTime').hide();
                        $('#welcomeMessage').show();
                    }
                    idCondition = response.data.generalConditions.idCondition;
                    $('#pageWorking').removeClass("loading-state");
                } else {
                    goToPage(response.data.redirectUrl);
                }
            },
            onWarning: function(response){
                
                if (response.code === "API004W") {
                    
                    $('#field_secondFactor').val("")
                    
                    $('#captcha1').show(); grecaptcha.reset(recaptchaStep1);
                    
                    $("#captcha2").hide();
                    $('#field_username').val("");
                    $("#loginStep2").addClass("hidden_absolute");
                    $("#loginStep3").addClass("hidden_absolute");
                    $("#loginStep4").addClass("hidden_absolute");
                    $("#loginStep1").removeClass("hidden_absolute");
                    $('.btn.loading-state').removeClass('loading-state');
                    $("#loginFirstSteps").removeClass("hidden_absolute");
                    exchangeToken = null;
                }
                $('#pageWorking').removeClass("loading-state");
                showFormErrors(response);
            }
        });
    }

    function acceptGeneralConditions() {
        $('#pageWorking').addClass("loading-state");
        $.postWithTimeout({
            url: "/frontend/login/accept-general-conditions",
            data: {
                _exchangeToken: exchangeToken,
                acceptConditions: $('#acceptGeneralConditionsCheck').hasClass("checkbox-on"),
                redirectUrl: getURLParameter('url')
            },
            onSuccess: function (response) {
                goToPage(response.data.redirectUrl);
            },
            onWarning: function(response){
                
                if (response.code === "") {
                    
                    $('#field_secondFactor').val("")
                    
                    
                    $("#captcha2").hide();
                    $('#field_username').val("");
                    $("#loginStep2").addClass("hidden_absolute");
                    $("#loginStep3").addClass("hidden_absolute");
                    $("#loginStep4").addClass("hidden_absolute");
                    $("#loginStep1").removeClass("hidden_absolute");
                    $('.btn.loading-state').removeClass('loading-state');
                    $("#loginFirstSteps").removeClass("hidden_absolute");
                    exchangeToken = null;
                }
                $('#div-state-error-2').html('<div class="message state-error"><p class="icon-error">' + 'Debe aceptar las condiciones generales' + '</p></div>');
                $('html, body').animate({
                    scrollTop: 0
                }, 1000);
                classicShow('#div-state-error-2', 1500);
                clearTimeout(message_timeout);
                message_timeout = setTimeout(function(){
                    classicHide('#div-state-error-2', 1500);
                }, 20000);
                $('#pageWorking').removeClass("loading-state");
            }
        });
    }

    function downloadGeneralConditions(){
        goToPage('/frontend/login/download-general-conditions' + "?channel=" + getDeviceEnvironment() + "&idCondition=" + idCondition);
    }

    function updateRememberDocumentAndCard(){
        var card = $('#field_username').val();
        var document = $('#field_documentNumber').val();

        if($('#rememberCardCheck').hasClass('checkbox-on')){
            if(card.indexOf('*')===-1){
                
                localStorage.setItem("rememberCard", card);
            };
            if (document.indexOf('*')===-1){
                localStorage.setItem("rememberDocument", document);
            }
        } else {
            
            localStorage.removeItem("rememberCard");
            localStorage.removeItem("rememberDocument");
        }
    }

    function fillSecuritySealWrapper(){
        $(".security-seal-wrapper").postWithTimeout({
            url: "/frontend/enrollment/security-seals?inLogin=true",
            data: {_exchangeToken: exchangeToken, _securitySeal: $('#field_securitySeal').val()},
            onSuccess: function (response) {
                $('.security-seal-wrapper').html(response);
            }
        });
    }

    function maskField(unmaskedValue, remain) {
        if (unmaskedValue){
            if (unmaskedValue.length > 1) {
                var masked = "";
                for (i = 0; i < unmaskedValue.length - 4; i++) {
                    masked += "*";
                }
            }
            masked += unmaskedValue.substring(unmaskedValue.length - remain, unmaskedValue.length);
            return masked;
        } else {
            return "";
        }
    }

    function closeColorbox(){
        $.colorbox.close()
    }
</script>


</div>
            </div>

            <div id="pageWorking" class="page-loading-state">
                <div class="loading-indicator-wrapper">
                    <span class="loading-indicator"></span>
                </div>
            </div>
            <!--body-mobile-external-->
            <a href="javascript:;" id="btn_menu_mobile" class="mobile-only"></a>
        </div>

        




<div class="fancy-modal-wrapper" id="template-loading-modal">
    <div class="fancy-modal-overlay">&nbsp;</div>
    <div class="fancy-modal no-print">
        <div class="main-content-header">
            <div class="modal-toolbar"><button class="btn btn-secondary icon-close btn-small" id="btnCloseModal" onclick="closeModal();">Cerrar</button></div>
        </div>
        <div class="main_modal_content_wrapper">
            <div class="main-content modal_main_content">
                <div class="modal-header">
                    <h1 class="modal-content-title" id="modalContentTitle" ></h1>
                </div>
                <div id="modalContent">
                    
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    /*javascript to activate and close the modal window*/
    
    var opening = false;
    $(window).on('resize', resizeModal);
    $('.modal_form').on('resize', resizeModal);

    var $divModal = $('#template-loading-modal');
    $divModal.on('focus', '#field_pin', function () {
        hideNativeKeyboard($('#field_pin'));
    });

    $divModal.on('focus', '#field_password', function () {
        hideNativeKeyboard($('#field_password'));
    });
    randomizeKeys();

    function activateModal(title, content) {
        if (!opening) {
            opening = true;
            $('.fancy-modal').addClass('visible_element');
            if (title !== '') {
                $('#modalContentTitle').show().html(title);
            } else {
                $('#modalContentTitle').hide().html('');
            }
            $('#modalContent').html(content);
            if ($('#btn_menu_mobile').is(':visible')) {
                activateVerticalModal();
            } else {
                activateHorizontalModal();
            }
            /*
             * si es mobile le cambiamos el tipo al input para que en lugar de que aparezca
             * el teclado normal, quede solo el numérico
             */
            if (isMobile()) {
                $('input[name=otp]').prop('type', 'number');
            }
        }
    }

    function closeModal() {
        $('.fancy-modal').removeClass('visible_element');
        if ($('#btn_menu_mobile').is(':visible')) {

            closeVerticalModal();
        }
        else {
            closeHorizontalModal();
        }
    }

     function activateHorizontalModal() {
        var height;
        /*fix bug*/
        if (parseInt($('.fancy-modal').css('top')) > 78) {
            $('.fancy-modal').css('top', '78px');
        }
//        $('body').css('overflow', 'hidden');

        var header = $('.main-header').length > 0 ? parseInt($('.main-header').outerHeight().toFixed()) : 0;
        var footer = 0;
        var page_height = parseInt($(window).outerHeight().toFixed());
        if ($('.main-footer').css('position') == 'fixed') {
            footer = parseInt($('.main-footer').outerHeight().toFixed());
        }
        height = (page_height - (footer + header));
        $('.fancy-modal').css('height', height + 'px');

        var inner = $('.main-content-wrapper').length > 0 ? $('.main-content-wrapper').outerWidth() - 1 : $('.external-wrapper').outerWidth() - 1;
        var width = '-=' + inner + 'px';

        $('.fancy-modal').css('width', inner);
        $('.fancy-modal').css('display', 'block');

        $('.fancy-modal-overlay').fadeIn(700);
        $('.fancy-modal').animate({
            'marginLeft': width
        }, 500, function () {
            opening = false;
                });

        $('.modal_form').css('height', (height - 20) + 'px');
        $('.modal_form').addClass('scrollable');
        $('.main_modal_content_wrapper').css('height', (height - 100) + 'px');
        $('.main_modal_content_wrapper').css('overflow', 'auto');
    }

    function activateVerticalModal() {
        var scrollbar = 0;
        var visibleHeight;
        var footerHeight;
        var footerPadding = 10;
        if ($('body').hasScrollBar() && false) {
            scrollbar += 21;
        }
        $('.fancy-modal').css('width', $(window).width() + scrollbar);

        $('body').css('overflow', 'hidden');
        $('.fancy-modal').css('display', 'block');

        $('.fancy-modal-overlay').fadeIn(1500);
        $('.fancy-modal').animate({
            'top': '50px'
        }, 500, function () {
            opening = false;
        });
        visibleHeight = $(window).height() + 'px';
        $('.fancy-modal').css('height', visibleHeight);
        $('.fancy-modal').css('overflow-x', 'hidden');

        footerHeight = $('.modal-footer').height();
        if (!isNaN(parseInt($('.modal-footer').css('padding')))) {
            footerPadding = parseInt($('.modal-footer').css('padding'));
        }
        if (footerHeight !== null) {
            $('.modal-footer').css('padding-bottom', (footerHeight + footerPadding) + 'px');
        }
    }

    (function ($) {
        $.fn.hasScrollBar = function () {
            return this.get(0).scrollHeight > this.height();
        }
    })(jQuery);

    function closeHorizontalModal() {
        var width = "0px";
        $('body').css('overflow', 'visible');
        $('.fancy-modal-overlay').fadeOut(700);
        $('.fancy-modal').animate({
            'marginLeft': width
        }, 500);
    }
    function closeVerticalModal() {
        var top = "0px";
        $('body').css('overflow', 'visible');
        $('.fancy-modal-overlay').fadeOut(700);
        $('.fancy-modal').animate({
            'top': '100%'
        }, 500);
    }

    function resizeModal() {
        var footer = 0;
        var height;
        var modal_is_visible = $('.fancy-modal').hasClass('visible_element');
        if (modal_is_visible) {
            if ($('#btn_menu_mobile').is(':visible')) {
                $('.fancy-modal').css('width', $(window).width());

                height = $(window).height() + 'px';
                $('.fancy-modal').css('height', height);
                $('.fancy-modal').css('margin-left', '0px');
                $('.fancy-modal').css('top', '50px');
                $('.fancy-modal').css('overflow-x', 'hidden');
            }
            else {
                var header = parseInt($('.main-header').height().toFixed());
                if ($('.main-footer').css('position') == 'fixed') {
                    footer = parseInt($('.main-footer').height().toFixed());
                }
                var page_height = parseInt($(window).height().toFixed());
                height = (page_height - (footer + header)) + 'px';
                $('.fancy-modal').css('height', height);
                $('.fancy-modal').css('top', header + 'px');

                $('.fancy-modal').css('margin-left', '100%');
                var inner = $('.inner-container').width();
                $('.fancy-modal').css('width', inner);
                $('.fancy-modal').css('margin-left', '-' + inner + 'px');
                $('.fancy-modal').css('overflow-x', 'hidden');
            }
        } else {
            /*fix bug*/
            if ($('#btn_menu_mobile').is(':visible')) {
                if ($('.fancy-modal').css('top') != '100%') {
                    $('.fancy-modal').css('top', '100%');
                }
            }
        }
    }
</script><script type="text/javascript">

            documentReady(function () {
                initPageTooltips();
                $('.google').on("click", function(){
                    window.open('https://play.google.com/store/apps/details?id=com.mibanco.bancamovil&amp;hl=es_PE');
                });
                $('.apple').on("click", function(){
                    window.open('https://apps.apple.com/pe/app/mibanco/id1437814246');
                });
                $('#close-button').on("click", function(){ 
                    $('.smart-banner').hide();
                    $('.external-wrapper').css('padding-top','0')
                    return false; 
                });

            });            
            function showSmartBanner (){
                $('.smart-banner').show();
                if ($('.smart-banner').is(':visible')) {
                    $('.external-wrapper').css('padding-top','130px')
                }
                $(window).on("resize", function() {
                    if (!$('.smart-banner').is(':visible')) {
                        $('.external-wrapper').css('padding-top','0')
                    } else {
                        $('.external-wrapper').css('padding-top','130px')
                    }
                });
            }
            function hideSmartBanner(){
                $('.smart-banner').hide();
                $('.external-wrapper').css('padding-top','0');
                $('meta[name="smartbanner:enabled-platforms"]').remove();
                $('meta[name="apple-itunes-app"]').remove();
                $('head').append( '<meta name="smartbanner:enabled-platforms" content="none">' );
            }

        </script>
    <script defer src="https://static.cloudflareinsights.com/beacon.min.js/vedd3670a3b1c4e178fdfb0cc912d969e1713874337387" integrity="sha512-EzCudv2gYygrCcVhu65FkAxclf3mYM6BCwiGUm6BEuLzSb5ulVhgokzCZED7yMIkzYVg65mxfIBNdNra5ZFNyQ==" data-cf-beacon='{"rayId":"881b97efded50dd7","b":1,"version":"2024.4.1","token":"d9a54a422e244978a37171e0c2c3b97a"}' crossorigin="anonymous"></script>
</body>

<!-- Mirrored from zonasegura.mibanco.com.pe/frontend/login/b.resolvedLink by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 10 May 2024 17:19:23 GMT -->
</html>